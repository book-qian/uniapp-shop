{"version":3,"file":"my-login.js","sources":["../../../../../../components/my-login/my-login.vue","../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/L1VzZXJzL3lhbmd5b25ncWlhbi9jb2RlL3VuaS1zaG9wL2NvbXBvbmVudHMvbXktbG9naW4vbXktbG9naW4udnVl"],"sourcesContent":["<template>\n\t<view class=\"login-container\">\n\t\t<uni-icons type=\"contact-filled\" size=\"100\" color=\"#afafaf\"></uni-icons>\n\t\t<button type=\"primary\" class=\"btn-login\" open-type=\"getUserInfo\" @getuserinfo=\"loginHandler\">一键登录</button>\n\t\t<text class=\"tips-text\">登录后尽享更多权益</text>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue';\nimport { useStore } from 'vuex';\nconst TOKEN = 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIzLCJpYXQiOjE1NjQ3MzAwNzksImV4cCI6MTAwMTU2NDczMDA3OH0.YPt-XeLnjV-_1ITaXGY2FhxmCe4NvXuRnRB8OMCfnPo';\nconst store = useStore();\nconst redirectInfo = computed(() => store.state['m_user'].redirectInfo);\n\nconst loginHandler = e => {\n\tstore.commit('m_user/updateUserinfo', e.detail.userInfo);\n\tgetToken(e.detail);\n};\nconst getToken = async ({ encryptedData, iv, rawData, signature }) => {\n\tconst { errMsg, code } = await uni.login();\n\tif (errMsg !== 'login:ok') return uni.$showMessage('登录失败');\n\n\tconst query = {\n\t\tcode,\n\t\tencryptedData,\n\t\tiv,\n\t\trawData,\n\t\tsignature\n\t};\n\n\tconst { data: loginResult } = await uni.$http.post('/api/public/v1/users/wxlogin', query);\n\tconst { meta, message } = loginResult;\n\tif (meta.status == 200) return uni.$showMessage('登录失败');\n\tuni.$showMessage('登录成功');\n\tstore.commit('m_user/updateToken', TOKEN);\n\n\t// 登录成功之后再跳转原来的页面\n\tif (!redirectInfo.value) return;\n\tconst { openType = '', from: url } = redirectInfo.value;\n\tif (redirectInfo.value && openType === 'switchTab') {\n\t\tuni[openType]({\n\t\t\turl,\n\t\t\tcomplete: () => {\n\t\t\t\tstore.commit('m_user/updateRedirectInfo', null);\n\t\t\t}\n\t\t});\n\t}\n};\n</script>\n\n<style lang=\"scss\">\n.login-container {\n\theight: 750rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: center;\n\talign-items: center;\n\tbackground-color: #f5f5f5;\n\tposition: relative;\n\toverflow: hidden;\n\t// 绘制底部椭圆\n\t&::after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\twidth: 100%;\n\t\theight: 40px;\n\t\tbackground-color: #fff;\n\t\tborder-radius: 100%;\n\t\tposition: absolute;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\ttransform: translateY(50%);\n\t}\n\n\t.btn-login {\n\t\twidth: 90%;\n\t\tborder-radius: 100px;\n\t\tmargin: 15px 0;\n\t\tbackground-color: #c00000;\n\t}\n\t.tips-text {\n\t\tcolor: gray;\n\t\tfont-size: 12px;\n\t}\n}\n</style>\n","import Component from '/Users/yangyongqian/code/uni-shop/components/my-login/my-login.vue'\nwx.createComponent(Component)"],"names":["store","useStore","redirectInfo","computed","state","loginHandler","e","commit","detail","userInfo","getToken","async","encryptedData","iv","rawData","signature","errMsg","code","uni","index","login","$showMessage","query","data","loginResult","$http","post","meta","message","status","value","openType","from","url","common_vendor","complete","wx","createComponent","Component"],"mappings":"6IAWA,MACMA,EAAQC,EAAQA,WAChBC,EAAeC,EAAQA,UAAC,IAAMH,EAAMI,MAAc,OAAEF,eAEpDG,EAAoBC,IACzBN,EAAMO,OAAO,wBAAyBD,EAAEE,OAAOC,UAC/CC,EAASJ,EAAEE,OAAM,EAEZE,EAAWC,OAASC,gBAAeC,KAAIC,UAASC,gBACrD,MAAMC,OAAEA,EAAQC,KAAAA,SAAeC,EAAGC,MAACC,QACnC,GAAe,aAAXJ,EAA8BE,OAAAA,EAAGC,MAACE,aAAa,QAEnD,MAAMC,EAAQ,CACbL,OACAL,gBACAC,KACAC,UACAC,cAGOQ,KAAMC,SAAsBN,EAAAA,MAAIO,MAAMC,KAAK,+BAAgCJ,IAC7EK,KAAEA,EAAMC,QAAAA,GAAYJ,EAC1B,GAAmB,KAAfG,EAAKE,OAAsBX,OAAAA,EAAAA,MAAIG,aAAa,QAKhD,WAJIA,aAAa,QACXrB,EAAAO,OAAO,qBAxBA,4JA2BRL,EAAa4B,MAAO,OACzB,MAAMC,SAAEA,EAAW,GAAIC,KAAMC,GAAQ/B,EAAa4B,MAC9C5B,EAAa4B,OAAsB,cAAbC,GACtBG,EAAAf,MAACY,GAAU,CACbE,MACAE,SAAU,KACHnC,EAAAO,OAAO,4BAA6B,KAAI,GAGhD,wFC9CF6B,GAAGC,gBAAgBC"}