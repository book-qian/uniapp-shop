"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/api.js");if(require("../../utils/axios.js"),!Array){e.resolveComponent("uni-icons")()}Math;const s={__name:"my-settle",setup(s){const o=e.useStore(),a=e.computed((()=>o.getters["m_cart/allCount"])),r=e.computed((()=>o.getters["m_cart/checkedCount"])),u=e.computed((()=>a.value===r.value)),c=()=>o.commit("m_cart/updateAllGoodsState",!u.value),i=e.computed((()=>o.state.m_user.token)),n=()=>r.value?i.value?void f():l():e.index.$showMessage("请先勾选备忘录"),d=e.ref(3),m=e.ref(null),l=()=>{p(d.value),m.value=setInterval((()=>{if(d.value--,d.value<=0)return clearInterval(m.value),void e.index.switchTab({url:"/pages/my/my",success:()=>{o.commit("m_user/updateRedirectInfo",{openType:"switchTab",from:"/pages/cart/cart"})}});p(d.value)}),1e3)},p=t=>{e.index.showToast({title:`请登录后再入库，${t}秒之后将跳转登录页面`,icon:"none",mask:!0,duration:1500})},v=e.computed((()=>o.getters["m_cart/checkedGoodsAmount"])),f=async()=>{const s={order_price:"0.01",consignee_addr:"",goods:e.computed((()=>o.state.m_cart.cart)).value.filter((e=>e.goods_state)).map((e=>({goods_id:e.goods_id,goods_number:e.goods_count,goods_price:e.goods_price})))},{data:a}=await t.fetchPost("/api/public/v1/my/orders/create",s),{meta:r,message:u}=a;if(200!==r.status)return e.index.$showMessage("操作失败");const c=u.order_number,{data:i}=await t.fetchPost("/api/public/v1/my/orders/req_unifiedorder",c),{meta:n,message:d}=i;if(200!==(null==n?void 0:n.status))return e.index.$showMessage("操作失败");const m=d.pay;e.index.requestPayment({...m,success:async s=>{const{data:o}=await t.fetchPost("/api/public/v1/my/orders/chkOrder",{order_number:c});if(200!==o.meta.status)return e.index.$showMessage("订单未支付！");e.index.showToast({title:"支付完成！",icon:"success"})},fail:t=>e.index.$showMessage("订单未支付！")})};return(t,s)=>({a:e.unref(u),b:e.o(c),c:e.p({type:"fire",size:"17",color:"#f2ba4b"}),d:e.t(e.unref(v)),e:e.t(e.unref(r)),f:e.o(n)})}};wx.createComponent(s);
//# sourceMappingURL=my-settle.js.map
