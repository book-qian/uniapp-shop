"use strict";const e=require("../../common/vendor.js"),t={__name:"my-settle",setup(t){const s=e.useStore(),a=e.computed((()=>s.getters["m_cart/allCount"])),o=e.computed((()=>s.getters["m_cart/checkedCount"])),r=e.computed((()=>a.value===o.value)),u=()=>s.commit("m_cart/updateAllGoodsState",!r.value),d=e.computed((()=>s.getters["m_user/addstr"])),n=e.computed((()=>s.state.m_user.token)),c=()=>o.value?d.value?n.value?void v():l():e.index.$showMessage("请先选择地址"):e.index.$showMessage("请先勾选商品"),i=e.ref(3),m=e.ref(null),l=()=>{p(i.value),m.value=setInterval((()=>{if(i.value--,i.value<=0)return clearInterval(m.value),void e.index.switchTab({url:"/pages/my/my",success:()=>{s.commit("m_user/updateRedirectInfo",{openType:"switchTab",from:"/pages/cart/cart"})}});p(i.value)}),1e3)},p=t=>{e.index.showToast({title:`请登录后再结算，${t}秒之后将跳转登录页面`,icon:"none",mask:!0,duration:1500})},g=e.computed((()=>s.getters["m_cart/checkedGoodsAmount"])),v=async()=>{const t=e.computed((()=>s.state.m_cart.cart)).value.filter((e=>e.goods_state)).map((e=>({goods_id:e.goods_id,goods_number:e.goods_count,goods_price:e.goods_price}))),a={order_price:"0.01",consignee_addr:d.value,goods:t},{data:o}=await e.index.$http.post("/api/public/v1/my/orders/create",a),{meta:r,message:u}=o;if(200!==r.status)return e.index.$showMessage("创建订单失败");const n=u.order_number,{data:c}=await e.index.$http.post("/api/public/v1/my/orders/req_unifiedorder",n),{meta:i,message:m}=c;if(200!==(null==i?void 0:i.status))return e.index.$showMessage("创建订单失败");const l=m.pay;e.index.requestPayment({...l,success:async t=>{const{data:s}=await e.index.$http.post("/api/public/v1/my/orders/chkOrder",{order_number:n});if(200!==s.meta.status)return e.index.$showMessage("订单未支付！");e.index.showToast({title:"支付完成！",icon:"success"})},fail:t=>e.index.$showMessage("订单未支付！")})};return(t,s)=>({a:e.unref(r),b:e.o(u),c:e.t(e.unref(g)),d:e.t(e.unref(o)),e:e.o(c)})}};wx.createComponent(t);
//# sourceMappingURL=my-settle.js.map
