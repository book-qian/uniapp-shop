{"version":3,"file":"goods_list.js","sources":["../../../../../../subpkg/goods_list/goods_list.vue","../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3VicGtnL2dvb2RzX2xpc3QvZ29vZHNfbGlzdC52dWU"],"sourcesContent":["<template>\n\t<view class=\"goods-list\">\n\t\t<view v-for=\"(goods, i) in goodsList\" :key=\"i\" @click=\"gotoGoodsDetail(goods)\"><my-goods :goods=\"goods\"></my-goods></view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, reactive } from 'vue';\nimport { onLoad, onReachBottom, onPullDownRefresh } from '@dcloudio/uni-app';\nimport { ajaxGet } from '@/utils/api.js';\n\nconst queryObj = reactive({\n\tquery: '',\n\tcid: '',\n\tpagenum: 1,\n\tpagesize: 10\n});\nconst isload = ref(false); // 节流阀\nconst total = ref(0);\nconst goodsList = ref([]);\nconst getGoodsList = async cb => {\n\tisload.value = true;\n\tconst { data: res } = await ajaxGet('/api/public/v1/goods/search', queryObj);\n\tisload.value = false;\n\n\t// 下拉刷新请求数据之后 关闭下拉效果\n\tcb && cb();\n\n\tconst { meta, message } = res;\n\tif (meta.status !== 200) return uni.$showMessage();\n\ttotal.value = message.total;\n\tgoodsList.value = [...goodsList.value, ...message.goods];\n};\n\nconst gotoGoodsDetail = ({ goods_id }) => {\n\tuni.navigateTo({\n\t\turl: '/subpkg/goods_detail/goods_detail?goods_id=' + goods_id\n\t});\n};\n\n// 触底事件/上拉加载\nonReachBottom(() => {\n\t// 判断数据加载完毕\n\tif (queryObj.pagenum * queryObj.pagesize >= total.value) return uni.$showMessage('数据加载完毕');\n\tif (isload.value) retuen;\n\tqueryObj.pagenum++;\n\tgetGoodsList();\n});\n\n//下拉刷新\nonPullDownRefresh(() => {\n\tqueryObj.pagenum = 1;\n\ttotal.value = 0;\n\tgoodsList.value = [];\n\n\t// 重新获取数据\n\tgetGoodsList(() => uni.stopPullDownRefresh());\n});\n\nonLoad(({ query = '', cid = '' }) => {\n\tqueryObj.query = query;\n\tqueryObj.cid = cid;\n\tgetGoodsList();\n});\n</script>\n\n<style lang=\"scss\"></style>\n","import MiniProgramPage from '/Users/yangyongqian/code/uni-shop/subpkg/goods_list/goods_list.vue'\nwx.createPage(MiniProgramPage)"],"names":["queryObj","reactive","query","cid","pagenum","pagesize","isload","ref","total","goodsList","getGoodsList","async","cb","value","data","res","ajaxGet","meta","message","status","uni","index","$showMessage","goods","onReachBottom","retuen","onPullDownRefresh","stopPullDownRefresh","onLoad","goods_id","navigateTo","url","wx","createPage","MiniProgramPage"],"mappings":"8MAWM,MAAAA,EAAWC,EAAAA,SAAS,CACzBC,MAAO,GACPC,IAAK,GACLC,QAAS,EACTC,SAAU,KAELC,EAASC,EAAAA,KAAI,GACbC,EAAQD,EAAAA,IAAI,GACZE,EAAYF,EAAAA,IAAI,IAChBG,EAAeC,MAAMC,IAC1BN,EAAOO,OAAQ,EACT,MAAEC,KAAMC,SAAcC,EAAAA,QAAQ,8BAA+BhB,GACnEM,EAAOO,OAAQ,EAGfD,GAAMA,IAEA,MAAAK,KAAEA,EAAMC,QAAAA,GAAYH,EAC1B,GAAoB,MAAhBE,EAAKE,OAAuBC,OAAAA,EAAGC,MAACC,eACpCd,EAAMK,MAAQK,EAAQV,MACtBC,EAAUI,MAAQ,IAAIJ,EAAUI,SAAUK,EAAQK,MAAK,SAUxDC,EAAAA,eAAc,KAEb,GAAIxB,EAASI,QAAUJ,EAASK,UAAYG,EAAMK,MAAcO,OAAAA,EAAGC,MAACC,aAAa,UAC7EhB,EAAOO,OAAOY,OACTzB,EAAAI,iBAKVsB,EAAAA,mBAAkB,KACjB1B,EAASI,QAAU,EACnBI,EAAMK,MAAQ,EACdJ,EAAUI,MAAQ,GAGlBH,GAAa,IAAMU,EAAAA,MAAIO,uBAAqB,IAG7CC,EAAMA,QAAC,EAAG1B,QAAQ,GAAIC,MAAM,OAC3BH,EAASE,MAAQA,EACjBF,EAASG,IAAMA,6FA3BQ,GAAG0B,eAC1BT,EAAAA,MAAIU,WAAW,CACdC,IAAK,8CAAgDF,GACrD,kBCpCFG,GAAGC,WAAWC"}