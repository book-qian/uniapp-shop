{"version":3,"file":"search.js","sources":["../../../../../../subpkg/search/search.vue","../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3VicGtnL3NlYXJjaC9zZWFyY2gudnVl"],"sourcesContent":["<template>\n\t<!-- 搜索框 -->\n\t<div class=\"search-box\"><uni-search-bar placeholder=\"请输入搜索内容\" @input=\"input\" cancelButton=\"none\" :radius=\"100\"></uni-search-bar></div>\n\t<!-- 搜索建议列表 -->\n\t<view class=\"sugg-list\" v-if=\"kw.length !== 0\">\n\t\t<view class=\"sugg-item\" @click=\"gotoGoodsDetail(item)\" v-for=\"(item, i) in searchResult\" :key=\"i\">\n\t\t\t<view class=\"goods-name\">{{ item.goods_name }}</view>\n\t\t\t<uni-icons type=\"arrowright\" size=\"16\"></uni-icons>\n\t\t</view>\n\t</view>\n\t<!-- 搜索历史 -->\n\t<view class=\"history-box\" v-else>\n\t\t<!-- 标题区域 -->\n\t\t<view class=\"history-title\">\n\t\t\t<text>搜索历史</text>\n\t\t\t<uni-icons type=\"trash\" size=\"17\" @click=\"clean\"></uni-icons>\n\t\t</view>\n\t\t<!-- 列表区域 -->\n\t\t<view class=\"history-list\"><uni-tag @click=\"gotoGoodsList(item)\" inverted :text=\"item\" v-for=\"(item, i) in histories\" :key=\"i\"></uni-tag></view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\n\nconst searchHistory = ref([]);\nconst kw = ref('');\nconst saveHistory = () => {\n\tconst set = new Set(searchHistory.value);\n\tset.delete(kw.value);\n\tset.add(kw.value);\n\tsearchHistory.value = Array.from(set);\n\t//搜索历史的持久化存储\n\tuni.setStorageSync('kw', JSON.stringify(searchHistory.value));\n};\n\nconst clean = () => {\n\tsearchHistory.value = [];\n\tuni.setStorageSync('kw', '[]');\n};\n\nconst gotoGoodsList = item => {\n\tuni.navigateTo({\n\t\turl: '/subpkg/goods_list/goods_list?query=' + item\n\t});\n};\n\nconst gotoGoodsDetail = ({ goods_id }) => {\n\tuni.navigateTo({\n\t\turl: '/subpkg/goods_detail/goods_detail?goods_id=' + goods_id\n\t});\n};\n\nconst searchResult = ref([]);\nconst getSearchList = async () => {\n\tif (kw.value.length === 0) {\n\t\tsearchResult.value = [];\n\t\treturn;\n\t}\n\tconst { data: res } = await uni.$http.get('/api/public/v1/goods/qsearch', { query: kw.value });\n\tconst { meta, message } = res;\n\tif (meta.status !== 200) return uni.$showMessage();\n\n\tsearchResult.value = message;\n\tsaveHistory();\n};\n\nconst timer = ref(null); // 防抖处理\nconst input = value => {\n\tclearTimeout(timer.value);\n\ttimer.value = setTimeout(() => {\n\t\tkw.value = value;\n\t\tgetSearchList();\n\t}, 500);\n};\n\nconst histories = computed(() => [...searchHistory.value].reverse());\n\nonLoad(() => {\n\tsearchHistory.value = JSON.parse(uni.getStorageSync('kw') || '[]');\n});\n</script>\n\n<style lang=\"scss\">\n.search-box {\n\tposition: sticky;\n\ttop: 0;\n\tz-index: 999;\n}\n.sugg-list {\n\tpadding: 0 5px;\n\t.sugg-item {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\tborder-bottom: 1px solid #efefef;\n\t\tpadding: 13px 0px;\n\t\t.goods-name {\n\t\t\twhite-space: nowrap;\n\t\t\toverflow: hidden;\n\t\t\ttext-overflow: ellipsis;\n\t\t\tfont-size: 12px;\n\t\t\tmargin-right: 3px;\n\t\t}\n\t}\n}\n.history-box {\n\tpadding: 0 5px;\n\t.history-title {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\theight: 40px;\n\t\tborder-bottom: 1px solid #efefef;\n\t\tfont-size: 13px;\n\t}\n\t:deep(.history-list) {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tuni-tag {\n\t\t\tmargin-top: 5px;\n\t\t\tmargin-right: 5px;\n\t\t}\n\t}\n}\n</style>\n","import MiniProgramPage from '/Users/yangyongqian/code/uni-shop/subpkg/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["searchHistory","ref","kw","clean","value","uni","setStorageSync","searchResult","getSearchList","async","length","data","res","index","$http","get","query","meta","message","status","$showMessage","set","Set","delete","add","Array","from","JSON","stringify","timer","input","clearTimeout","setTimeout","histories","computed","reverse","onLoad","parse","getStorageSync","goods_id","navigateTo","url","item","wx","createPage","MiniProgramPage"],"mappings":"gbA0BA,MAAMA,EAAgBC,EAAAA,IAAI,IACpBC,EAAKD,EAAAA,IAAI,IAUTE,EAAQ,KACbH,EAAcI,MAAQ,GACtBC,EAAAA,MAAIC,eAAe,KAAM,KAAI,EAexBC,EAAeN,EAAAA,IAAI,IACnBO,EAAgBC,UACjB,GAAoB,IAApBP,EAAGE,MAAMM,OAEZ,YADAH,EAAaH,MAAQ,IAGtB,MAAQO,KAAMC,SAAcP,EAAGQ,MAACC,MAAMC,IAAI,+BAAgC,CAAEC,MAAOd,EAAGE,SAChFa,KAAEA,EAAMC,QAAAA,GAAYN,EAC1B,GAAoB,MAAhBK,EAAKE,OAAuBd,OAAAA,EAAGQ,MAACO,eAEpCb,EAAaH,MAAQc,EApCF,MACnB,MAAMG,EAAM,IAAIC,IAAItB,EAAcI,OAC9BiB,EAAAE,OAAOrB,EAAGE,OACViB,EAAAG,IAAItB,EAAGE,OACGJ,EAAAI,MAAQqB,MAAMC,KAAKL,GAEjChB,EAAGQ,MAACP,eAAe,KAAMqB,KAAKC,UAAU5B,EAAcI,OAAM,MAkCvDyB,EAAQ5B,EAAAA,IAAI,MACZ6B,EAAiB1B,IACtB2B,aAAaF,EAAMzB,OACbyB,EAAAzB,MAAQ4B,YAAW,KACxB9B,EAAGE,MAAQA,QAET,IAAG,EAGD6B,EAAYC,EAAQA,UAAC,IAAM,IAAIlC,EAAcI,OAAO+B,mBAE1DC,EAAAA,QAAO,KACQpC,EAAAI,MAAQuB,KAAKU,MAAMhC,EAAGQ,MAACyB,eAAe,OAAS,KAAI,2MAhC1C,GAAGC,eAC1BlC,EAAAA,MAAImC,WAAW,CACdC,IAAK,8CAAgDF,GACrD,yIAToB,CAAQG,IAC7BrC,EAAAA,MAAImC,WAAW,CACdC,IAAK,uCAAyCC,GAC9C,oEC5CFC,GAAGC,WAAWC"}