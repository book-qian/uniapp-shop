{"version":3,"file":"my-login.js","sources":["../../../../../../components/my-login/my-login.vue","../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/L1VzZXJzL3lhbmd5b25ncWlhbi9jb2RlL3VuaS1zaG9wL2NvbXBvbmVudHMvbXktbG9naW4vbXktbG9naW4udnVl"],"sourcesContent":["<template>\n\t<view class=\"login-container\">\n\t\t<uni-icons type=\"contact-filled\" size=\"100\" color=\"#afafaf\"></uni-icons>\n\t\t<button type=\"primary\" class=\"btn-login\" open-type=\"getUserInfo\" @getuserinfo=\"loginHandler\">一键登录</button>\n\t\t<text class=\"tips-text\">登录后尽享更多权益</text>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue';\nimport { useStore } from 'vuex';\nimport { ajaxGet, fetchPost } from '@/utils/api.js';\nconst TOKEN = 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOjIzLCJpYXQiOjE1NjQ3MzAwNzksImV4cCI6MTAwMTU2NDczMDA3OH0.YPt-XeLnjV-_1ITaXGY2FhxmCe4NvXuRnRB8OMCfnPo';\nconst store = useStore();\nconst redirectInfo = computed(() => store.state['m_user'].redirectInfo);\n\nconst loginHandler = e => {\n\tstore.commit('m_user/updateUserinfo', e.detail.userInfo);\n\tgetToken(e.detail);\n};\nconst getToken = async ({ encryptedData, iv, rawData, signature }) => {\n\tconst { errMsg, code } = await uni.login();\n\tif (errMsg !== 'login:ok') return uni.$showMessage('登录失败');\n\n\tconst query = {\n\t\tcode,\n\t\tencryptedData,\n\t\tiv,\n\t\trawData,\n\t\tsignature\n\t};\n\n\tconst { data: loginResult } = await fetchPost('/api/public/v1/users/wxlogin', query);\n\tconst { meta, message } = loginResult;\n\tif (meta.status == 200) return uni.$showMessage('登录失败');\n\tuni.$showMessage('登录成功');\n\tstore.commit('m_user/updateToken', TOKEN);\n\n\t// 登录成功之后再跳转原来的页面\n\tif (!redirectInfo.value) return;\n\tconst { openType = '', from: url } = redirectInfo.value;\n\tif (redirectInfo.value && openType === 'switchTab') {\n\t\tuni[openType]({\n\t\t\turl,\n\t\t\tcomplete: () => {\n\t\t\t\tstore.commit('m_user/updateRedirectInfo', null);\n\t\t\t}\n\t\t});\n\t}\n};\n</script>\n\n<style lang=\"scss\">\n.login-container {\n\theight: 750rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: center;\n\talign-items: center;\n\tbackground-color: #f5f5f5;\n\tposition: relative;\n\toverflow: hidden;\n\t// 绘制底部椭圆\n\t&::after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\twidth: 100%;\n\t\theight: 40px;\n\t\tbackground-color: #fff;\n\t\tborder-radius: 100%;\n\t\tposition: absolute;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\ttransform: translateY(50%);\n\t}\n\n\t.btn-login {\n\t\twidth: 90%;\n\t\tborder-radius: 100px;\n\t\tmargin: 15px 0;\n\t\tbackground-color: #f2ba4b;\n\t}\n\t.tips-text {\n\t\tcolor: gray;\n\t\tfont-size: 12px;\n\t}\n}\n</style>\n","import Component from '/Users/yangyongqian/code/uni-shop/components/my-login/my-login.vue'\nwx.createComponent(Component)"],"names":["useStore","computed","uni","fetchPost"],"mappings":";;;;;;;;;;;;;;;AAYA,UAAM,QAAQ;AACd,UAAM,QAAQA,cAAQ,SAAA;AACtB,UAAM,eAAeC,cAAQ,SAAC,MAAM,MAAM,MAAM,QAAQ,EAAE,YAAY;AAEtE,UAAM,eAAe,OAAK;AACzB,YAAM,OAAO,yBAAyB,EAAE,OAAO,QAAQ;AACvD,eAAS,EAAE,MAAM;AAAA,IAClB;AACA,UAAM,WAAW,OAAO,EAAE,eAAe,IAAI,SAAS,UAAS,MAAO;AACrE,YAAM,EAAE,QAAQ,KAAI,IAAK,MAAMC,cAAG,MAAC,MAAK;AACxC,UAAI,WAAW;AAAY,eAAOA,cAAG,MAAC,aAAa,MAAM;AAEzD,YAAM,QAAQ;AAAA,QACb;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAEC,YAAM,EAAE,MAAM,YAAa,IAAG,MAAMC,UAAAA,UAAU,gCAAgC,KAAK;AACnF,YAAM,EAAE,MAAM,QAAS,IAAG;AAC1B,UAAI,KAAK,UAAU;AAAK,eAAOD,cAAAA,MAAI,aAAa,MAAM;AACtDA,0BAAI,aAAa,MAAM;AACvB,YAAM,OAAO,sBAAsB,KAAK;AAGxC,UAAI,CAAC,aAAa;AAAO;AACzB,YAAM,EAAE,WAAW,IAAI,MAAM,IAAK,IAAG,aAAa;AAClD,UAAI,aAAa,SAAS,aAAa,aAAa;AACnDA,sBAAG,MAAC,QAAQ,EAAE;AAAA,UACb;AAAA,UACA,UAAU,MAAM;AACf,kBAAM,OAAO,6BAA6B,IAAI;AAAA,UAC9C;AAAA,QACJ,CAAG;AAAA,MACD;AAAA,IACF;;;;;;;;;;;;;;AChDA,GAAG,gBAAgB,SAAS;"}